{%- macro generate_trackback_link(trackback, include_posted_date=True) -%}
<h3 class="trackback-title">
  <a class="mathjax" rel="external nofollow" href="{{ url_for('browse.tb_redirect', trackback_id=trackback.trackback_id, hashed_document_id=trackback.hashed_document_id) }}">
  {{- trackback.title|entity_to_utf|truncate(150) }}</a>
</h3>
<p class="trackback-source">
  [
  {%- if trackback.blog_name %}
    {{ trackback.blog_name|trim|entity_to_utf|truncate(50) -}} @
  {% endif -%}
  {%- if trackback.has_valid_url %}
    <a class="mathjax" rel="external nofollow" href="{{ url_for('browse.tb_redirect', trackback_id=trackback.trackback_id, hashed_document_id=trackback.hashed_document_id) }}">{{ trackback.display_url|truncate(30,False) }}</a>
  {% else %}
    INVALID-URL
  {% endif -%}
  ]
  {%- if include_posted_date %}
    <small>trackback posted {{ trackback.posted_datetime.strftime('%a, %-d %b %Y %H:%M:%S %Z') }}</small>
  {% endif %}
</p>
{%- endmacro -%}
